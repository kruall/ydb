<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actor System Monitoring</title>
    <!-- Подключаем Bootstrap CSS -->
    <link rel="stylesheet" href="/lwtrace/mon/static/css/bootstrap.min.css">
    <!-- Подключаем D3 стили -->
    <link rel="stylesheet" href="/lwtrace/mon/static/css/d3-gantt.css">
    <!-- Подключаем наши стили -->
    <link rel="stylesheet" href="/actor_system_mon/static/style.css">
</head>
<body>
    <div class="container mt-4">
        <h1>Actor System Harmonizer History</h1>
        <div class="range-selector mb-3">
            <label for="levelSelect" class="form-label">Уровень детализации:</label>
            <select id="levelSelect" class="form-select" style="width: auto; display: inline-block;">
                <option value="iteration" selected>Итерация</option>
                <option value="pool">Пул</option>
                <option value="thread">Поток</option>
            </select>
            <div class="form-check form-switch d-inline-block ms-3">
                <input class="form-check-input" type="checkbox" id="timeMode">
                <label class="form-check-label" for="timeMode">Режим времени</label>
            </div>
            <div id="iterationMode">
                <label for="iterationFrom" class="form-label ms-3">От итерации:</label>
                <input type="number" id="iterationFrom" class="form-control" value="-30" style="width: 80px; display: inline-block;">
                <label for="iterationTo" class="form-label ms-3">До итерации:</label>
                <input type="number" id="iterationTo" class="form-control" placeholder="последняя" style="width: 80px; display: inline-block;">
            </div>
            <div id="timeMode" style="display: none;">
                <label for="timeFrom" class="form-label ms-3">От времени (мс):</label>
                <input type="number" id="timeFrom" class="form-control" value="-10000000" style="width: 120px; display: inline-block;">
                <label for="timeTo" class="form-label ms-3">До времени (мс):</label>
                <input type="number" id="timeTo" class="form-control" placeholder="текущее" style="width: 120px; display: inline-block;">
            </div>
            <button id="refreshButton" class="btn btn-primary ms-2">Обновить</button>
            <div class="form-check form-switch d-inline-block ms-3">
                <input class="form-check-input" type="checkbox" id="sortNewestFirst">
                <label class="form-check-label" for="sortNewestFirst">Новые сверху</label>
            </div>
        </div>
        <ul class="nav nav-tabs mb-3" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="data-tab" data-bs-toggle="tab" data-bs-target="#dataTab" type="button" role="tab" aria-controls="dataTab" aria-selected="true">История</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="charts-tab" data-bs-toggle="tab" data-bs-target="#chartsTab" type="button" role="tab" aria-controls="chartsTab" aria-selected="false">Метрики</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="cpu-tab" data-bs-toggle="tab" data-bs-target="#cpuTab" type="button" role="tab" aria-controls="cpuTab" aria-selected="false">Использование CPU</button>
            </li>
        </ul>
        
        <div class="tab-content" id="mainTabsContent">
            <div class="tab-pane fade show active" id="dataTab" role="tabpanel" aria-labelledby="data-tab">
                <div id="loading" class="alert alert-info" style="display: none;">Загрузка данных...</div>
                <div id="error" class="alert alert-danger" style="display: none;"></div>
                <div id="dataContainer">
                    <!-- Данные будут загружены сюда -->
                </div>
            </div>
            
            <div class="tab-pane fade" id="chartsTab" role="tabpanel" aria-labelledby="charts-tab">
                <div class="row mb-3">
                    <div class="col-md-12">
                        <div class="chart-controls mb-3">
                            <label for="chartMetricSelect" class="form-label">Метрика:</label>
                            <select id="chartMetricSelect" class="form-select" style="width: auto; display: inline-block;">
                                <option value="budget">Budget</option>
                                <option value="lostCpu">Lost CPU</option>
                                <option value="freeSharedCpu">Free Shared CPU</option>
                            </select>
                            <button id="refreshChartButton" class="btn btn-primary ms-2">Обновить график</button>
                        </div>
                        <div id="chartContainer" class="chart-container">
                            <svg id="metricsChart" width="100%" height="400"></svg>
                        </div>
                        
                        <div class="mt-4">
                            <h4>Пулы процессора</h4>
                            <div class="chart-controls mb-3">
                                <label for="poolSelect" class="form-label">Пул:</label>
                                <select id="poolSelect" class="form-select" style="width: auto; display: inline-block;">
                                    <!-- Будет заполнено пулами из данных -->
                                </select>
                                <label for="poolMetricSelect" class="form-label ms-3">Метрика:</label>
                                <select id="poolMetricSelect" class="form-select" style="width: auto; display: inline-block;">
                                    <option value="avgPingUs">Avg Ping (us)</option>
                                    <option value="currentThreadCount">Thread Count</option>
                                    <option value="localQueueSize">Queue Size</option>
                                </select>
                            </div>
                            <div id="poolChartContainer" class="chart-container">
                                <svg id="poolChart" width="100%" height="400"></svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="cpuTab" role="tabpanel" aria-labelledby="cpu-tab">
                <div class="row mb-3">
                    <div class="col-md-12">
                        <div class="chart-controls mb-3">
                            <label for="cpuMetricSelect" class="form-label">Тип данных:</label>
                            <select id="cpuMetricSelect" class="form-select" style="width: auto; display: inline-block;">
                                <option value="elapsedCpu">Elapsed CPU</option>
                                <option value="usedCpu">Used CPU</option>
                            </select>
                            <label for="cpuValueSelect" class="form-label ms-3">Значение:</label>
                            <select id="cpuValueSelect" class="form-select" style="width: auto; display: inline-block;">
                                <option value="cpu">Общее</option>
                                <option value="lastSecondCpu">За последнюю секунду</option>
                            </select>
                            <button id="refreshCpuButton" class="btn btn-primary ms-2">Обновить</button>
                        </div>
                        
                        <div class="chart-container">
                            <h5>Потребление CPU по пулам</h5>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="showAllPools" checked>
                                <label class="form-check-label" for="showAllPools">Показать все пулы</label>
                            </div>
                            <div id="poolSelectorContainer" class="mb-2" style="display: none;">
                                <div id="poolCheckboxes" class="d-flex flex-wrap"></div>
                            </div>
                            <svg id="cpuPoolsChart" width="100%" height="400"></svg>
                        </div>
                        
                        <div class="chart-container mt-4">
                            <h5>Количество потоков по пулам</h5>
                            <svg id="threadsChart" width="100%" height="300"></svg>
                        </div>
                        
                        <div class="chart-container mt-4">
                            <h5>Budget и загрузка системы</h5>
                            <svg id="budgetChart" width="100%" height="300"></svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Подключаем jQuery, Bootstrap и D3.js -->
    <script src="/lwtrace/mon/static/js/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="/lwtrace/mon/static/js/d3-tip-0.8.0-alpha.1.js"></script>

    <!-- Подключаем разделенные JS файлы -->
    <script src="/actor_system_mon/static/js/utils.js"></script>
    <script src="/actor_system_mon/static/js/renderUtils.js"></script>
    <script src="/actor_system_mon/static/js/data.js"></script>
    <script src="/actor_system_mon/static/js/charts.js"></script>
    <script src="/actor_system_mon/static/js/ui.js"></script>

    <!-- Основной файл приложения (инициализация и обработчики) -->
    <script src="/actor_system_mon/static/app.js"></script>
</body>
</html> 